## 用户指南

这个项目用来将PIV处理照片后生成的坐标和速度文件，转化为Tecplot软件可以读取的文件形式，并且根据需求，提取每一帧特定点的速度，汇总到一个文件中，便于作图。

这里有2个Python代码，分别是 **process.py** 和 **plot.py**。接下来我将详细地为您介绍如何使用他们。

您需要做的就是在每个代码文件第4行开始的被 **#** 号包围的区域内，修改参数和文件路径。

###  0. 原始文件

在介绍程序之前，我们先来看一下PIV软件处理照片后生成的数据文件。这些文件存放在路径下名为 */PIVAData* 的文件夹下，在我的代码里定义了路径名为 *input_folder = 'K:/Velocity'* 。打开文件我们可以看到，前11行是一些PIV软件的头文件，从12行开始前四列是x、y坐标和对应的速度，长度单位是mm（虽然文件写的是cm,但实际上是mm/s），第五列是flag值，其中0代表原始速度，1代表插值速度。

```c
FieldType:        1
Row:      55
Col:      79
xWnd:      32
yWnd:      32
xOvlp:    0.50
yOvlp:    0.50
ImgWidth:    1280
ImgHeight:     896
IsCalibrated:       1
     x(cm)     y(cm)   u(cm/s)   v(cm/s)      Flag
      1.87       1.87 -4336.8041   292.9310          0
      1.87       3.75 -9387.3490   427.2369          0
      1.87       5.62 -9504.4598   256.3121          0
      1.87       7.49 -8211.4399   155.3913          0
      1.87       9.37 -8389.8648    80.1826          1
      1.87      11.24 -9470.7628    61.3555          0
    ...
```

我们只需要从第12行开始的前四列数据。这里每个 x 坐标对应的55个 y 坐标，文件的总行数是4356，减去头文件11行:（4356-11）/55=79，因此有79个 x 坐标。

事实上并不是第12行开始，在代码测试中发现，PIV处理后的数据，在文件的第一个x里，有可能会少几个y，导致转换后导入Tecplot画幅不一致。第一个x在画面的边缘，可能在后处理时忽略掉了。于是把第一个 x 所在的行删掉，就OK了。因此，只有78个 x 坐标。

### 1. 文件转换

文件转换功能是通过 **process.py** 实现的。为了将原始文件和转化后的区分开，将输出文件存放在 */out* 文件夹下，新定义了输出路径名为 *output_folder = 'K:/out'*  。

代码中设置了从倒数4290行开始读取，4290=78×55

是的**从倒数n行**读取巧妙地删除了前几行不合适的数据，与其说是删除，不如称之为忽略。读取之后，所有的行会存储在变量 Lines 中，通过 split 将 Lines 分开，逐个添加到arr[ ]数组中，这个不需要提前声明数组的维数和空间，相对Java和C++来说非常友好。由于原始的数据是以毫米为单位的，速度也是 mm/s，于是把第三列和四列都除以 1000, 这样就化成了 m/s，通过 del 功能删除了第五列的 flag 值。

之后在输出路径下创建文件，先写入Tecplot头文件，就是下面2行，然后把数组依次写进去。

```c
variables="x","y","u","v"
zone i=55,j=78,f=point
```

variables是前四列对应的 4 个变量名，i 是 y 的数量，j是 x 的数量。如果您需要修改，只要改 **4290、55 和 78**就行了。

本Python文件最下面是循环，可以遍历文件夹下所有的后缀为 .dat 的文件，都执行上述操作。如果您需要其他的文件格式，可以把代码中的 .dat 改掉，比如改为.txt 。

因此，您只需要改**路径、变量数量**，之后执行代码就可以了。生成的文件内容如下所示

```c
variables="x","y","u","v"
zone i=55,j=78,f=point
3.75 1.87 -0.0163 0.1376
3.75 3.75 -3.3639 0.3257
3.75 5.62 -5.2026 0.2697
3.75 7.49 -5.9529 0.2024
3.75 9.37 -9.4184 0.1036
3.75 11.24 -6.4731 0.0732
3.75 13.12 -9.3635 -0.073
...
```

### 2.数据提取

数据提取功能是通过 **plot.py** 实现的，提取出来的数据文件在 */plot* 文件夹下。

您直接看代码就会明白了，就是让速度数组 arr[ ] 的元素等于设定的值时，将这个元素追加到另一个全局数组 data[ ] 中,您只需要修改代码第12行的 84.32 和 54.34 这两个数字就可以了，其中 84.32是 x 坐标，54.34 是 y 坐标，具体您要看速度文件中前两列的 x 和 y，否则是不能提取出来的。

修改好后，运行代码，就可以在plot文件夹下找到一个文件，里面是两列数据，分别是x和y方向的速度。

复制这两列数据到excel中，使用**分列**功能，将数据分到2列中，然后新插入一列时间、速度归一化等等，就可以作图了。

### 3.后记

这个代码只是实现了数据处理的基本要求，有很多需要手动输入修改的参数，未来可以优化一下，自动识别文件内坐标的数量等...大家可以共同来开发完善。

